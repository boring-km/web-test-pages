<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Myanmar Bible - Judson (1835) / 개역개정</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap');

    :root {
      --bg: #f8f6f2;
      --bg-card: #ffffff;
      --text: #2c2c2c;
      --text-muted: #777;
      --border: #e0ddd5;
      --accent: #8b5e3c;
      --accent-light: #d4a574;
      --accent-bg: #f5ede4;
      --sidebar-bg: #faf8f5;
      --verse-hover: #fdf6ee;
      --highlight: #fff3cd;
      --shadow: rgba(0,0,0,0.08);
      --font-size: 18px;
    }

    .dark {
      --bg: #1a1a1e;
      --bg-card: #24242a;
      --text: #d8d4cf;
      --text-muted: #888;
      --border: #3a3a40;
      --accent: #d4a574;
      --accent-light: #8b5e3c;
      --accent-bg: #2a2520;
      --sidebar-bg: #1e1e22;
      --verse-hover: #2a2822;
      --highlight: #3d3520;
      --shadow: rgba(0,0,0,0.3);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Padauk', 'Myanmar Text', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.8;
      transition: background 0.3s, color 0.3s;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 1px 4px var(--shadow);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
      white-space: nowrap;
    }

    .header-title small {
      font-weight: 400;
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
    }

    .btn {
      background: var(--accent-bg);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .btn:hover { background: var(--accent-light); color: #fff; }
    .btn.active { background: var(--accent); color: #fff; }

    .font-controls {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .font-controls .btn {
      padding: 6px 10px;
      font-size: 16px;
      font-weight: bold;
      min-width: 32px;
      justify-content: center;
    }

    .font-size-label {
      font-size: 12px;
      color: var(--text-muted);
      min-width: 30px;
      text-align: center;
    }

    /* Search */
    .search-bar {
      display: none;
      position: fixed;
      top: 56px;
      left: 0;
      right: 0;
      z-index: 99;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 10px 16px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .search-bar.open { display: block; }

    .search-input-wrap {
      display: flex;
      gap: 8px;
      max-width: 700px;
      margin: 0 auto;
    }

    .search-input-wrap input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      font-family: 'Padauk', 'Myanmar Text', sans-serif;
      background: var(--bg);
      color: var(--text);
      outline: none;
    }

    .search-input-wrap input:focus {
      border-color: var(--accent);
    }

    .search-results-info {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 8px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Layout */
    .layout {
      display: flex;
      margin-top: 56px;
      min-height: calc(100vh - 56px);
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border);
      overflow-y: auto;
      position: fixed;
      top: 56px;
      bottom: 0;
      left: 0;
      z-index: 50;
      transition: transform 0.3s;
    }

    .sidebar.hidden { transform: translateX(-100%); }

    .sidebar-section {
      padding: 12px 0;
    }

    .sidebar-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      padding: 8px 16px 4px;
      font-weight: 700;
    }

    .book-item {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.15s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .book-item:hover { background: var(--accent-bg); }
    .book-item.active { background: var(--accent-bg); color: var(--accent); font-weight: 700; }

    .book-item .en-name {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Chapter selector */
    .chapter-selector {
      display: none;
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      background: var(--bg-card);
    }

    .chapter-selector.open { display: block; }

    .chapter-selector h3 {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .chapter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(38px, 1fr));
      gap: 4px;
    }

    .chapter-btn {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px;
      text-align: center;
      cursor: pointer;
      font-size: 13px;
      color: var(--text);
      transition: all 0.15s;
    }

    .chapter-btn:hover { background: var(--accent-light); color: #fff; }
    .chapter-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

    /* Main content */
    .main {
      flex: 1;
      margin-left: 280px;
      padding: 32px 24px;
      max-width: 800px;
      transition: margin-left 0.3s;
    }

    .main.full { margin-left: 0; }

    .content-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--accent-bg);
    }

    .content-header h1 {
      font-size: 24px;
      color: var(--accent);
    }

    .content-header .sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .verse {
      padding: 6px 8px;
      border-radius: 4px;
      transition: background 0.15s;
      font-size: var(--font-size);
    }

    .verse:hover { background: var(--verse-hover); }
    .verse.highlighted { background: var(--highlight); }

    .verse-num {
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      color: var(--accent);
      vertical-align: super;
      margin-right: 4px;
      min-width: 18px;
    }

    .verse-kr {
      display: block;
      font-family: 'Noto Sans KR', sans-serif;
      font-size: calc(var(--font-size) - 2px);
      color: var(--text-muted);
      margin-left: 22px;
      margin-top: 2px;
      line-height: 1.6;
    }

    .chapter-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .chapter-nav .btn { font-size: 14px; }

    /* Welcome screen */
    .welcome {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .welcome h2 {
      font-size: 28px;
      color: var(--accent);
      margin-bottom: 12px;
    }

    .welcome p { font-size: 16px; margin-bottom: 8px; }

    /* Search results */
    .search-result {
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
      background: var(--bg-card);
      cursor: pointer;
      transition: box-shadow 0.2s;
    }

    .search-result:hover { box-shadow: 0 2px 8px var(--shadow); }

    .search-result .ref {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .search-result .text {
      font-size: 15px;
    }

    .search-result mark {
      background: var(--highlight);
      color: inherit;
      padding: 0 2px;
      border-radius: 2px;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
    }

    .spinner {
      display: inline-block;
      width: 32px;
      height: 32px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Mobile overlay */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 40;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 280px;
        transform: translateX(-100%);
      }
      .sidebar.open { transform: translateX(0); }
      .overlay.open { display: block; }
      .main { margin-left: 0 !important; padding: 24px 16px; }
      .header-title small { display: none; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <button class="btn" id="menuBtn" title="Menu">&#9776;</button>
    <div class="header-title">
      သမ္မာကျမ်းစာ <small>Judson / 개역개정</small>
    </div>
    <div class="header-controls">
      <button class="btn" id="searchBtn" title="Search">&#128269;</button>
      <div class="font-controls">
        <button class="btn" id="fontDown" title="Smaller">A-</button>
        <span class="font-size-label" id="fontLabel">18</span>
        <button class="btn" id="fontUp" title="Larger">A+</button>
      </div>
      <button class="btn" id="darkBtn" title="Dark Mode">&#9789;</button>
    </div>
  </div>

  <!-- Search bar -->
  <div class="search-bar" id="searchBar">
    <div class="search-input-wrap">
      <input type="text" id="searchInput" placeholder="검색어 입력 (미얀마어/한국어)" />
      <button class="btn" id="searchGo">ရှာ</button>
      <button class="btn" id="searchClose">&times;</button>
    </div>
    <div class="search-results-info" id="searchInfo"></div>
  </div>

  <!-- Sidebar overlay (mobile) -->
  <div class="overlay" id="overlay"></div>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-section-title">ဓမ္မဟောင်း (Old Testament)</div>
        <div id="otBooks"></div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-section-title">ဓမ္မသစ် (New Testament)</div>
        <div id="ntBooks"></div>
      </div>
      <div class="chapter-selector" id="chapterSelector">
        <h3 id="chapterTitle">အခန်းကြီး (Chapter)</h3>
        <div class="chapter-grid" id="chapterGrid"></div>
      </div>
    </nav>

    <!-- Main content -->
    <main class="main" id="main">
      <div class="welcome" id="welcome">
        <h2>သမ္မာကျမ်းစာ</h2>
        <p>Judson Bible (1835)</p>
        <p style="font-size:14px; margin-top:16px;">ဘယ်ဘက်မှ စာအုပ်တစ်အုပ် ရွေးပါ</p>
        <p style="font-size:13px;">Select a book from the sidebar</p>
      </div>
      <div id="content" style="display:none;">
        <div class="content-header">
          <h1 id="contentTitle"></h1>
          <div class="sub" id="contentSub"></div>
        </div>
        <div id="verses"></div>
        <div class="chapter-nav" id="chapterNav" style="display:none;">
          <button class="btn" id="prevChapter">&larr; ယခင်</button>
          <button class="btn" id="nextChapter">ရှေ့ &rarr;</button>
        </div>
      </div>
      <div id="searchResults" style="display:none;"></div>
    </main>
  </div>

  <script>
    const DATA_PATH = 'myanmar-bible-data';
    const EN_BOOKS = {
      1:'Genesis',2:'Exodus',3:'Leviticus',4:'Numbers',5:'Deuteronomy',
      6:'Joshua',7:'Judges',8:'Ruth',9:'1 Samuel',10:'2 Samuel',
      11:'1 Kings',12:'2 Kings',13:'1 Chronicles',14:'2 Chronicles',
      15:'Ezra',16:'Nehemiah',17:'Esther',18:'Job',19:'Psalms',
      20:'Proverbs',21:'Ecclesiastes',22:'Song of Solomon',23:'Isaiah',
      24:'Jeremiah',25:'Lamentations',26:'Ezekiel',27:'Daniel',
      28:'Hosea',29:'Joel',30:'Amos',31:'Obadiah',32:'Jonah',
      33:'Micah',34:'Nahum',35:'Habakkuk',36:'Zephaniah',37:'Haggai',
      38:'Zechariah',39:'Malachi',
      40:'Matthew',41:'Mark',42:'Luke',43:'John',44:'Acts',
      45:'Romans',46:'1 Corinthians',47:'2 Corinthians',48:'Galatians',
      49:'Ephesians',50:'Philippians',51:'Colossians',
      52:'1 Thessalonians',53:'2 Thessalonians',54:'1 Timothy',
      55:'2 Timothy',56:'Titus',57:'Philemon',58:'Hebrews',
      59:'James',60:'1 Peter',61:'2 Peter',62:'1 John',63:'2 John',
      64:'3 John',65:'Jude',66:'Revelation'
    };

    const KR_BOOKS = {
      1:'창세기',2:'출애굽기',3:'레위기',4:'민수기',5:'신명기',
      6:'여호수아',7:'사사기',8:'룻기',9:'사무엘상',10:'사무엘하',
      11:'열왕기상',12:'열왕기하',13:'역대상',14:'역대하',
      15:'에스라',16:'느헤미야',17:'에스더',18:'욥기',19:'시편',
      20:'잠언',21:'전도서',22:'아가',23:'이사야',
      24:'예레미야',25:'예레미야애가',26:'에스겔',27:'다니엘',
      28:'호세아',29:'요엘',30:'아모스',31:'오바댜',32:'요나',
      33:'미가',34:'나훔',35:'하박국',36:'스바냐',37:'학개',
      38:'스가랴',39:'말라기',
      40:'마태복음',41:'마가복음',42:'누가복음',43:'요한복음',44:'사도행전',
      45:'로마서',46:'고린도전서',47:'고린도후서',48:'갈라디아서',
      49:'에베소서',50:'빌립보서',51:'골로새서',
      52:'데살로니가전서',53:'데살로니가후서',54:'디모데전서',
      55:'디모데후서',56:'디도서',57:'빌레몬서',58:'히브리서',
      59:'야고보서',60:'베드로전서',61:'베드로후서',62:'요한일서',63:'요한이서',
      64:'요한삼서',65:'유다서',66:'요한계시록'
    };

    let booksIndex = [];
    let bookCache = {};
    let currentBook = null;
    let currentChapter = null;
    let fontSize = 18;

    // Init
    async function init() {
      const res = await fetch(`${DATA_PATH}/index.json`);
      booksIndex = await res.json();
      renderBookList();

      // Restore preferences
      if (localStorage.getItem('mb-dark') === 'true') document.body.classList.add('dark');
      const saved = parseInt(localStorage.getItem('mb-fontsize'));
      if (saved) { fontSize = saved; applyFontSize(); }

      // Handle URL hash
      if (location.hash) loadFromHash();
    }

    function renderBookList() {
      const otEl = document.getElementById('otBooks');
      const ntEl = document.getElementById('ntBooks');
      booksIndex.forEach(b => {
        const div = document.createElement('div');
        div.className = 'book-item';
        div.dataset.nr = b.nr;
        div.innerHTML = `<span>${b.name}</span><span class="en-name">${KR_BOOKS[b.nr]}</span>`;
        div.onclick = () => selectBook(b.nr);
        (b.nr <= 39 ? otEl : ntEl).appendChild(div);
      });
    }

    async function selectBook(nr) {
      currentBook = nr;
      // Highlight active
      document.querySelectorAll('.book-item').forEach(el => {
        el.classList.toggle('active', parseInt(el.dataset.nr) === nr);
      });
      // Load data
      if (!bookCache[nr]) {
        const res = await fetch(`${DATA_PATH}/${nr}.json`);
        bookCache[nr] = await res.json();
      }
      // Show chapter selector
      const book = bookCache[nr];
      const sel = document.getElementById('chapterSelector');
      const grid = document.getElementById('chapterGrid');
      document.getElementById('chapterTitle').textContent = `${book.name} - အခန်းကြီး`;
      grid.innerHTML = '';
      const chapters = Object.keys(book.chapters);
      chapters.forEach(ch => {
        const btn = document.createElement('div');
        btn.className = 'chapter-btn';
        btn.textContent = ch;
        btn.onclick = () => loadChapter(nr, parseInt(ch));
        grid.appendChild(btn);
      });
      sel.classList.add('open');

      // Auto-load chapter 1
      loadChapter(nr, 1);
    }

    function loadChapter(bookNr, chapterNr) {
      currentBook = bookNr;
      currentChapter = chapterNr;
      const book = bookCache[bookNr];
      const verses = book.chapters[String(chapterNr)];
      if (!verses) return;

      // Update hash
      location.hash = `${bookNr}/${chapterNr}`;

      // Hide welcome, search results
      document.getElementById('welcome').style.display = 'none';
      document.getElementById('searchResults').style.display = 'none';
      document.getElementById('content').style.display = 'block';

      // Header
      document.getElementById('contentTitle').textContent = `${book.name} ${chapterNr}`;
      document.getElementById('contentSub').textContent = `${KR_BOOKS[bookNr]} ${chapterNr}장 | ${EN_BOOKS[bookNr]} ${chapterNr}`;

      // Verses
      const container = document.getElementById('verses');
      container.innerHTML = '';
      verses.forEach(v => {
        const div = document.createElement('div');
        div.className = 'verse';
        div.id = `v${v.v}`;
        const krText = v.k ? `<span class="verse-kr">${v.k}</span>` : '';
        div.innerHTML = `<span class="verse-num">${v.v}</span>${v.t}${krText}`;
        container.appendChild(div);
      });

      // Chapter nav
      const totalCh = Object.keys(book.chapters).length;
      const nav = document.getElementById('chapterNav');
      nav.style.display = 'flex';
      document.getElementById('prevChapter').style.visibility = chapterNr > 1 ? 'visible' : 'hidden';
      document.getElementById('nextChapter').style.visibility = chapterNr < totalCh ? 'visible' : 'hidden';

      // Update chapter grid active
      document.querySelectorAll('.chapter-btn').forEach(btn => {
        btn.classList.toggle('active', parseInt(btn.textContent) === chapterNr);
      });

      // Close sidebar on mobile
      closeSidebar();

      // Scroll to top
      window.scrollTo(0, 0);
    }

    // Chapter navigation
    document.getElementById('prevChapter').onclick = () => {
      if (currentChapter > 1) loadChapter(currentBook, currentChapter - 1);
    };
    document.getElementById('nextChapter').onclick = () => {
      const book = bookCache[currentBook];
      const totalCh = Object.keys(book.chapters).length;
      if (currentChapter < totalCh) loadChapter(currentBook, currentChapter + 1);
    };

    // Sidebar toggle
    function closeSidebar() {
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('overlay').classList.remove('open');
      }
    }

    document.getElementById('menuBtn').onclick = () => {
      const sb = document.getElementById('sidebar');
      if (window.innerWidth <= 768) {
        sb.classList.toggle('open');
        document.getElementById('overlay').classList.toggle('open');
      } else {
        sb.classList.toggle('hidden');
        document.getElementById('main').classList.toggle('full');
      }
    };

    document.getElementById('overlay').onclick = closeSidebar;

    // Search
    document.getElementById('searchBtn').onclick = () => {
      const bar = document.getElementById('searchBar');
      bar.classList.toggle('open');
      if (bar.classList.contains('open')) {
        document.getElementById('searchInput').focus();
      }
    };

    document.getElementById('searchClose').onclick = () => {
      document.getElementById('searchBar').classList.remove('open');
      document.getElementById('searchInfo').textContent = '';
    };

    document.getElementById('searchInput').onkeydown = (e) => {
      if (e.key === 'Enter') doSearch();
    };
    document.getElementById('searchGo').onclick = doSearch;

    async function doSearch() {
      const query = document.getElementById('searchInput').value.trim();
      if (!query) return;

      document.getElementById('searchInfo').textContent = '검색 중...';
      const results = [];

      // Detect if query is Korean
      const isKorean = /[\uac00-\ud7af\u1100-\u11ff\u3130-\u318f\ua960-\ua97f\ud7b0-\ud7ff]/.test(query);

      // Load all books (with caching)
      for (let i = 1; i <= 66; i++) {
        if (!bookCache[i]) {
          try {
            const res = await fetch(`${DATA_PATH}/${i}.json`);
            bookCache[i] = await res.json();
          } catch(e) { continue; }
        }
        const book = bookCache[i];
        for (const [ch, verses] of Object.entries(book.chapters)) {
          for (const v of verses) {
            const myMatch = v.t.includes(query);
            const krMatch = v.k && v.k.includes(query);
            if (myMatch || krMatch) {
              results.push({
                bookNr: i,
                bookName: book.name,
                chapter: parseInt(ch),
                verse: v.v,
                text: v.t,
                krText: v.k || '',
                matchedKr: krMatch
              });
              if (results.length >= 200) break;
            }
          }
          if (results.length >= 200) break;
        }
        if (results.length >= 200) break;
      }

      // Display results
      document.getElementById('welcome').style.display = 'none';
      document.getElementById('content').style.display = 'none';
      const container = document.getElementById('searchResults');
      container.style.display = 'block';
      container.innerHTML = '';

      document.getElementById('searchInfo').textContent =
        `"${query}" - ${results.length}${results.length >= 200 ? '+' : ''}개 결과`;

      if (results.length === 0) {
        container.innerHTML = '<div class="loading">검색 결과가 없습니다</div>';
        return;
      }

      results.forEach(r => {
        const div = document.createElement('div');
        div.className = 'search-result';
        const qRegex = new RegExp(escapeRegex(query), 'g');
        const myHighlighted = r.matchedKr ? r.text : r.text.replace(qRegex, `<mark>${query}</mark>`);
        const krHighlighted = r.krText ? (r.matchedKr ? r.krText.replace(qRegex, `<mark>${query}</mark>`) : r.krText) : '';
        const krLine = krHighlighted ? `<div class="text" style="font-family:'Noto Sans KR',sans-serif;color:var(--text-muted);font-size:13px;margin-top:4px;">${krHighlighted}</div>` : '';
        div.innerHTML = `<div class="ref">${r.bookName} ${r.chapter}:${r.verse} (${KR_BOOKS[r.bookNr]} | ${EN_BOOKS[r.bookNr]})</div><div class="text">${myHighlighted}</div>${krLine}`;
        div.onclick = async () => {
          await selectBook(r.bookNr);
          loadChapter(r.bookNr, r.chapter);
          setTimeout(() => {
            const el = document.getElementById(`v${r.verse}`);
            if (el) {
              el.classList.add('highlighted');
              el.scrollIntoView({ behavior: 'smooth', block: 'center' });
              setTimeout(() => el.classList.remove('highlighted'), 3000);
            }
          }, 100);
        };
        container.appendChild(div);
      });
    }

    function escapeRegex(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Font size
    function applyFontSize() {
      document.documentElement.style.setProperty('--font-size', fontSize + 'px');
      document.getElementById('fontLabel').textContent = fontSize;
      localStorage.setItem('mb-fontsize', fontSize);
    }

    document.getElementById('fontUp').onclick = () => {
      if (fontSize < 32) { fontSize += 2; applyFontSize(); }
    };
    document.getElementById('fontDown').onclick = () => {
      if (fontSize > 12) { fontSize -= 2; applyFontSize(); }
    };

    // Dark mode
    document.getElementById('darkBtn').onclick = () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('mb-dark', document.body.classList.contains('dark'));
    };

    // Load from hash
    function loadFromHash() {
      const parts = location.hash.replace('#', '').split('/');
      if (parts.length >= 1) {
        const bookNr = parseInt(parts[0]);
        const chapterNr = parts[1] ? parseInt(parts[1]) : 1;
        if (bookNr >= 1 && bookNr <= 66) {
          selectBook(bookNr).then(() => {
            if (chapterNr) loadChapter(bookNr, chapterNr);
          });
        }
      }
    }

    window.onhashchange = loadFromHash;

    // Keyboard shortcuts
    document.onkeydown = (e) => {
      if (e.target.tagName === 'INPUT') return;
      if (e.key === 'ArrowLeft' && currentChapter > 1) {
        loadChapter(currentBook, currentChapter - 1);
      } else if (e.key === 'ArrowRight' && currentBook && bookCache[currentBook]) {
        const totalCh = Object.keys(bookCache[currentBook].chapters).length;
        if (currentChapter < totalCh) loadChapter(currentBook, currentChapter + 1);
      } else if (e.key === '/' || (e.ctrlKey && e.key === 'f')) {
        e.preventDefault();
        document.getElementById('searchBar').classList.add('open');
        document.getElementById('searchInput').focus();
      } else if (e.key === 'Escape') {
        document.getElementById('searchBar').classList.remove('open');
      }
    };

    init();
  </script>
</body>
</html>
